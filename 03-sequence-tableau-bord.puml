@startuml Sequence_Tableau_Bord
title Diagramme de Séquence - Cas: Consulter Tableau de Bord (MVC)

participant "Administrateur" as Admin
participant "Vue\nTableauBord" as Vue
participant "Contrôleur\nTableauBord" as Controleur
participant "Modèle\nStatistiques" as ModeleStats
participant "Modèle\nRapport" as ModeleRapport
participant "Modèle\nEvaluation" as ModeleEval

== Scénario Idéal ==

Admin -> Vue: Accéder au tableau de bord
activate Vue
Vue -> Controleur: chargerTableauBord()
activate Controleur

Controleur -> ModeleStats: obtenirStatistiquesGlobales()
activate ModeleStats
ModeleStats --> Controleur: StatistiquesGlobales
deactivate ModeleStats

Controleur -> ModeleEval: obtenirNombreEvaluations()
activate ModeleEval
ModeleEval --> Controleur: nombreEvaluations
deactivate ModeleEval

Controleur -> ModeleStats: obtenirMoyennesParEnseignant()
activate ModeleStats
ModeleStats --> Controleur: Map<Enseignant, Moyenne>
deactivate ModeleStats

Controleur -> ModeleStats: obtenirEvolutionTemporelle()
activate ModeleStats
ModeleStats --> Controleur: EvolutionTemporelle
deactivate ModeleStats

Controleur -> ModeleStats: obtenirTendances()
activate ModeleStats
ModeleStats --> Controleur: Tendances
deactivate ModeleStats

Controleur --> Vue: DonneesTableauBord(statistiques, moyennes, evolution, tendances)
deactivate Controleur
Vue --> Admin: Afficher tableau de bord complet
deactivate Vue

note over Admin, Vue
  Dashboard avec :
  - Graphiques de performance
  - Comparaisons enseignants
  - Tendances temporelles
  - Indicateurs clés
end note

== Alternative 1: Filtrage par Période ==

Admin -> Vue: Sélectionner période personnalisée
activate Vue
Vue -> Controleur: chargerTableauBord(dateDebut, dateFin)
activate Controleur

Controleur -> ModeleStats: obtenirStatistiquesParPeriode(dateDebut, dateFin)
activate ModeleStats
ModeleStats --> Controleur: StatistiquesPeriodes
deactivate ModeleStats

loop Pour chaque type de statistique
    Controleur -> ModeleStats: obtenirDonneesFiltrees(type, dateDebut, dateFin)
    activate ModeleStats
    ModeleStats --> Controleur: DonneesFiltrees
    deactivate ModeleStats
end

Controleur --> Vue: DonneesTableauBord filtrées
deactivate Controleur
Vue --> Admin: Afficher données période spécifiée
deactivate Vue

== Alternative 2: Génération de Rapport ==

Admin -> Vue: Générer rapport PDF
activate Vue
Vue -> Controleur: genererRapport(format, parametres)
activate Controleur

Controleur -> ModeleRapport: compilerDonneesRapport(parametres)
activate ModeleRapport

ModeleRapport -> ModeleStats: obtenirStatistiquesCompletes()
activate ModeleStats
ModeleStats --> ModeleRapport: Statistiques
deactivate ModeleStats

ModeleRapport -> ModeleEval: obtenirEvaluationsDetaillees()
activate ModeleEval
ModeleEval --> ModeleRapport: Liste<Evaluation>
deactivate ModeleEval

alt Format PDF
    ModeleRapport -> ModeleRapport: genererPDF(donnees)
    ModeleRapport --> Controleur: FichierPDF
else Format Excel
    ModeleRapport -> ModeleRapport: genererExcel(donnees)
    ModeleRapport --> Controleur: FichierExcel
else Format CSV
    ModeleRapport -> ModeleRapport: genererCSV(donnees)
    ModeleRapport --> Controleur: FichierCSV
end

deactivate ModeleRapport
Controleur --> Vue: Fichier rapport généré
deactivate Controleur
Vue --> Admin: Télécharger rapport
deactivate Vue

== Alternative 3: Erreur d'Accès aux Données ==

Admin -> Vue: Charger le tableau
activate Vue
Vue -> Controleur: chargerTableauBord()
activate Controleur

Controleur -> ModeleStats: obtenirStatistiquesGlobales()
activate ModeleStats

alt Erreur de connexion
    ModeleStats --> Controleur: Exception (ErreurConnexion)
    deactivate ModeleStats
    
    Controleur --> Vue: Erreur (code: ERREUR_CONNEXION)
    deactivate Controleur
    Vue --> Admin: "Erreur: Impossible de charger les données. Veuillez réessayer."
    deactivate Vue

else Données insuffisantes
    ModeleStats --> Controleur: Avertissement (DonneesInsuffisantes)
    deactivate ModeleStats
    
    Controleur --> Vue: Avertissement (données partielles disponibles)
    deactivate Controleur
    Vue --> Admin: Afficher tableau avec données partielles et message d'avertissement
    deactivate Vue

else Aucune donnée disponible
    ModeleStats --> Controleur: AucuneDonnee
    deactivate ModeleStats
    
    Controleur --> Vue: Aucune donnée
    deactivate Controleur
    Vue --> Admin: "Aucune donnée disponible pour le moment"
    deactivate Vue
end

== Alternative 4: Actualisation en Temps Réel ==

opt Mode temps réel activé
    loop Toutes les N secondes
        Vue -> Controleur: actualiserDonnees()
        activate Controleur
        
        Controleur -> ModeleStats: obtenirNouvellesDonnees()
        activate ModeleStats
        ModeleStats --> Controleur: NouvellesDonnees
        deactivate ModeleStats
        
        opt Nouvelles données disponibles
            Controleur --> Vue: DonneesActualisees
            deactivate Controleur
            Vue --> Admin: Mettre à jour affichage
        else Aucune nouvelle donnée
            Controleur --> Vue: Aucune mise à jour
            deactivate Controleur
        end
    end
end

== Alternative 5: Export de Données Spécifiques ==

Admin -> Vue: Exporter données spécifiques
activate Vue
Vue -> Controleur: exporterDonnees(criteres, format)
activate Controleur

Controleur -> ModeleStats: filtrerDonnees(criteres)
activate ModeleStats
ModeleStats --> Controleur: DonneesFiltrees
deactivate ModeleStats

opt Format demandé
    Controleur -> ModeleRapport: exporter(donnees, format)
    activate ModeleRapport
    ModeleRapport --> Controleur: FichierExport
    deactivate ModeleRapport
    
    Controleur --> Vue: Fichier prêt
    deactivate Controleur
    Vue --> Admin: Télécharger fichier
else Format non supporté
    Controleur --> Vue: Erreur (format non supporté)
    deactivate Controleur
    Vue --> Admin: "Format d'export non disponible"
end

deactivate Vue

@enduml
